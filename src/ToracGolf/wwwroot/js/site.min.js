var appToracGolf=angular.module("toracApp",["ngAnimate"]);!function(){"use strict";appToracGolf.directive("datePicker",function(){return{require:"?ngModel",restrict:"A",scope:{ngModel:"="},link:function(e,o,t,n){o.datepicker({maxDate:t.maxdate,onSelect:function(o){e.$apply(function(){e.ngModel=o})}})}}})}(),function(){"use strict";appToracGolf.factory("FileReader",["$q","$log",function(e,o){var t=function(e,o,t){return function(){t.$apply(function(){o.resolve(e.result)})}},n=function(e,o,t){return function(){t.$apply(function(){o.reject(e.result)})}},a=function(e,o){return function(e){o.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}},r=function(e,o){var r=new FileReader;return r.onload=t(r,e,o),r.onerror=n(r,e,o),r.onprogress=a(r,o),r};return{ReadAsDataURL:function(o,t){var n=e.defer();if(null==o)return n.resolve(null),n.promise;var a=r(n,t);return a.readAsDataURL(o),n.promise}}}])}(),function(){"use strict";appToracGolf.factory("httpRequestInterceptor",["$q",function(e){return{request:function(e){return e.headers.RequestVerificationToken=$("#__RequestVerificationToken").val(),$("#loadingDiv").show(),e},requestError:function(o){return $("#loadingDiv").hide(),e.reject(o)},response:function(e){return $("#loadingDiv").hide(),e},responseError:function(o){return $("#loadingDiv").hide(),e.reject(o)}}}]),appToracGolf.config(["$httpProvider",function(e){e.interceptors.push("httpRequestInterceptor")}])}(),function(){"use strict";appToracGolf.directive("modal",function(){return{template:'<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">{{title}}</h4></div><div class="modal-body">{{bodyhtml}}</div><div class="modal-footer"><button type="button" class="btn btn-default {{primarybuttonclass}}" data-dismiss="modal">{{closebuttontext}}</button></div></div></div></div>',restrict:"EA",replace:!0,transclude:!0,scope:{onmodalcloseevent:"&",ShowSavedSuccessfulModal:"="},link:function(e,o,t){e.title=t.title,e.bodyhtml=t.bodyhtml,e.closebuttontext=t.closebuttontext,e.primarybuttonclass=t.primarybuttonclass,e.$parent.$watch(t.showdialog,function(e){$(o).modal(e?"show":"hide")}),$(o).on("shown.bs.modal",function(){e.$apply(function(){e.$parent[t.visible]=!0})}),$(o).on("hidden.bs.modal",function(){e.$apply(function(){e.$parent[t.visible]=!1,e.onmodalcloseevent()})})}}})}(),function(){"use strict";appToracGolf.directive("modalevent",function(){return{restrict:"EA",replace:!1,scope:{showdialog:"="},link:function(e,o,t){e.$parent.$watch(t.showdialog,function(e){$(o).modal(e?"show":"hide")}),$(o).on("shown.bs.modal",function(){e.$apply(function(){e.showdialog=!0})}),$(o).on("hidden.bs.modal",function(){e.$apply(function(){e.showdialog=!1})})}}})}(),function(){"use strict";appToracGolf.directive("numbersOnly",function(){return{require:"ngModel",restrict:"A",scope:!0,link:function(e,o,t,n){function a(e,o){if(void 0==e)return"";var t;return t=o?e.replace(/[^0-9]/g,""):e.replace(/[^0-9.]/g,""),isNaN(t)&&(t=n.$modelValue),t!=e&&(n.$setViewValue(t),n.$render()),t}e.allowInts="true"===t.numbersOnlyAllowonlyints.toLowerCase(),n.$parsers.push(function(o){var t=e.allowInts;return a(o,t)})}}})}(),function(){"use strict";appToracGolf.factory("PagerFactory",function(){return{BuildPagerModel:function(e){for(var o=[],t=0;e>t;t++)o.push(t);return o}}})}(),function(){"use strict";appToracGolf.directive("select2",function(){return{require:"?ngModel",restrict:"A",scope:{ngModel:"="},link:function(e,o,t,n){e.$watch("ngModel",function(t){null!=t&&e.$$postDigest(function(){o.val(typeof e.ngModel+":"+t).trigger("change")})}),o.select2({placeholder:"Select a state"})}}})}(),function(){"use strict";appToracGolf.service("ValidationService",function(){return{ShowValidationErrors:function(e,o){if(e.validationErrors=[],o.data&&angular.isObject(o.data))for(var t in o.data)e.validationErrors.push(o.data[t][0]);else e.validationErrors.push(o.data)}}})}(),function(){appToracGolf.controller("CourseAddController",["$scope","ValidationService","FileReader","CourseHttp",function(e,o,t,n){e.init=function(o){e.model=o,e.ViewMode="AddCourse"},e.SaveACourse=function(){t.ReadAsDataURL(document.getElementById("CoursePicture").files[0],e).then(function(t){e.model.CourseImage=t,n.AddCourse(e.model,o).then(function(o){e.ShowSavedSuccessfulModal=!0},function(t){o.ShowValidationErrors(e,t)})})},e.SaveACourseDialogOkEvent=function(){window.location.href="ViewCourses"},e.AddTeeLocation=function(){e.TeeLocationTitle="Add A New Tee Location",e.InitTeeLocationView(null,{Description:"",Front9Par:null,Back9Par:null,Yardage:null,Slope:null,Rating:null,Par:function(){return parseInt(this.Front9Par)+parseInt(this.Back9Par)}})},e.EditTeeLocation=function(o){e.TeeLocationTitle="Edit Tee Location",e.InitTeeLocationView(o,e.model.TeeLocations[o])},e.InitTeeLocationView=function(o,t){e.validationErrors=[],e.TempTeeBeforeModifying={Index:o,Model:angular.copy(t)},e.ViewMode="EditTeeLocation",e.TempTeeLocation=angular.copy(t),null!=o&&e.model.TeeLocations.splice(o,1)},e.CancelTeeLocation=function(){e.validationErrors=[],null!=e.TempTeeBeforeModifying.Index&&e.model.TeeLocations.splice(e.TempTeeBeforeModifying.Index,0,e.TempTeeBeforeModifying.Model),e.ViewMode="AddCourse"},e.SaveTeeLocation=function(){return e.model.TeeLocations.Any(function(o){return o.Description===e.TempTeeLocation.Description})?void o.ShowValidationErrors(e,{data:"There is already a tee box with the same name"}):void n.AddTeeLocation(e.TempTeeLocation,o).then(function(o){e.model.TeeLocations.push(e.TempTeeLocation),e.ViewMode="AddCourse",e.validationErrors=[]},function(t){o.ShowValidationErrors(e,t)})},e.DeleteTeeLocation=function(o){e.model.TeeLocations.splice(o,1)},e.DefaultTeeButton=function(o){(o.which&&13==o.which||o.keyCode&&13==o.keyCode)&&e.SaveTeeLocation()}}])}(),function(){"use strict";appToracGolf.service("CourseHttp",["$http",function(e){return{AddCourse:function(o,t){return e.post("AddACourse",o,t)},AddTeeLocation:function(o,t){return e.post("ValidateTeeLocation",o,t)},CourseListing:function(o,t,n,a,r,i){return e.post("CourseListingSelectPage",{ResetPager:o,PageIndexId:t,SortBy:n,CourseNameFilter:a,StateFilter:r,CoursesPerPage:i})},CourseDelete:function(o){return e.post("CourseDelete",o)}}}])}(),function(){appToracGolf.controller("CourseListingController",["$scope","ValidationService","CourseHttp","PagerFactory",function(e,o,t,n){e.init=function(o,t,n,a,r,i){e.SortByLookup=t,e.CoursesPerPageLookup=r,e.SortBy=t[0].Value,e.CoursesPerPage=a,e.StateFilter=n,e.SearchByCourseName=i,e.CurrentPageId=0,e.BuildPager(o),e.FetchAPageOfData(!1)},e.BuildPager=function(o){e.TotalNumberOfPages=o,e.PagerElements=n.BuildPagerModel(o)},e.PagerClick=function(o){e.CurrentPageId=o,e.FetchAPageOfData(!1)},e.FetchAPageOfData=function(o){o&&(e.CurrentPageId=0),t.CourseListing(o,e.CurrentPageId,e.SortBy,e.SearchByCourseName,e.StateFilter,e.CoursesPerPage).then(function(o){e.PagedData=o.data.PagedData,null!=o.data.TotalNumberOfPages&&e.BuildPager(o.data.TotalNumberOfPages)},function(e){alert("Error: "+JSON.stringify(e))})},e.ArchiveACourse=function(o){e.CourseIdToDelete=o,e.DeleteCourseModalShow=!0},e.DeleteACourseConfirm=function(){t.CourseDelete(e.CourseIdToDelete).then(function(o){e.DeleteCourseModalShow=!1,e.FetchAPageOfData(!0)},function(e){alert("Error: "+JSON.stringify(e))})}}])}(),function(){appToracGolf.controller("DashboardController",["$scope","DashboardHttp",function(e,o){e.init=function(o){e.DashboardView=o,e.$watch(function(e){return e.DashboardView},function(){e.LoadDashboardView(e.DashboardView)})},e.RootPath=function(){return _rootDir},e.LoadDashboardView=function(t){o.ViewTypeHasChanged(t,e.RootPath()).then(function(o){e.Last5Rounds=o.data.Last5Rounds,e.Top5Rounds=o.data.Top5Rounds,e.LoadHandicapGrid(t,o.data.HandicapScoreSplitGrid),e.RoundPieChart(o.data.RoundPieChart),$(window).trigger("resize")})},e.LoadHandicapGrid=function(e,o){for(var t=[],n=[],a=0;a<o.length;a++){var r=o[a];t.push([Date.UTC(r.Year,r.Month-1,r.Day),r.Score]),n.push([Date.UTC(r.Year,r.Month-1,r.Day),r.Handicap])}$("#HandicapProgression").highcharts({credits:{enabled:!1},chart:{type:"spline",zoomType:"x"},title:{text:e+" Progression"},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b",year:"%b"},title:{text:"Date"}},yAxis:[{title:{text:"Round Score",style:{color:Highcharts.getOptions().colors[0]}},labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[0]}},opposite:!1},{labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[1]}},title:{text:"Handicap",style:{color:Highcharts.getOptions().colors[1]}}}],plotOptions:{spline:{marker:{enabled:!0}}},series:[{name:"Round",yAxis:0,data:t},{name:"Handicap",yAxis:1,data:n}]})},e.RoundPieChart=function(e){$("#ScorePieChart").highcharts({credits:!1,chart:{type:"pie",options3d:{enabled:!0,alpha:45,beta:0}},title:{text:"Round Scores"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}% [{point.y} Rounds]</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:35,dataLabels:{enabled:!0,format:"{point.name}"}}},series:[{type:"pie",name:"Round Breakdown",data:e}]})}}])}(),function(){"use strict";appToracGolf.service("DashboardHttp",["$http",function(e){return{ViewTypeHasChanged:function(o,t){return e.post(t+"DashboardViewTypeChange",{ViewType:o})}}}])}(),function(){appToracGolf.controller("SeasonAddController",["$scope","ValidationService","SeasonHttp","$filter",function(e,o,t,n){e.init=function(o){e.model=o},e.SaveASeason=function(){t.AddSeason(e.model,o).then(function(o){e.ShowSavedSuccessfulModal=!0},function(t){o.ShowValidationErrors(e,t)})},e.SaveASeasonDialogOkEvent=function(){window.location.href="SeasonListing"}}])}(),function(){"use strict";appToracGolf.service("SeasonHttp",["$http",function(e){return{AddSeason:function(o,t){return e.post("AddASeason",o,t)},SeasonListingFetchData:function(){return e.post("SeasonListing",{})},ArchiveASeason:function(o){return e.post("SeasonDelete",o)},SeasonMakeCurrent:function(o){return e.post("ChangeCurrentSeason",o)}}}])}(),function(){appToracGolf.controller("SeasonListingController",["$scope","ValidationService","SeasonHttp",function(e,o,t){e.init=function(o){e.CurrentSeasonId=o,e.FetchAPageOfData(!1)},e.FetchAPageOfData=function(){t.SeasonListingFetchData().then(function(o){e.PagedData=o.data.PagedData},function(e){alert("Error: "+JSON.stringify(e))})},e.ArchiveASeason=function(o,t){e.SeasonIdToDelete=o,e.NumberOfRoundsAssociatedWithThisSeason=t,e.DeleteSeasonModalShow=!0},e.ArchiveASeasonConfirm=function(){t.ArchiveASeason(e.SeasonIdToDelete).then(function(o){e.PagedData=o.data.PagedData,e.DeleteSeasonModalShow=!1},function(e){alert("Error: "+JSON.stringify(e))})},e.MakeCurrentSeason=function(e){t.SeasonMakeCurrent(e).then(function(e){e.data.Result&&window.location.reload()},function(e){alert("Error: "+JSON.stringify(e))})}}])}(),function(){appToracGolf.controller("RoundAddController",["$scope","ValidationService","RoundHttp","$filter",function(e,o,t,n){e.init=function(o){e.model=o,e.FetchCoursesForState()},e.$watch("model.RoundDate",function(o){e.model.RoundDate=n("date")(o,"MM/dd/yyyy")}),e.$watch("model.TeeLocationId",function(o){var t=null;null!=o&&null!=e.TeeBoxLookup&&(t=e.TeeBoxLookup.FirstOrDefault(function(e){return e.CourseTeeLocationId==o}));var n=function(e,o){return null==e?null:e[o]};e.TeeBoxSelectedInfo={Yardage:n(t,"Yardage"),Par:null==t?null:t.Front9Par+t.Back9Par,Slope:n(t,"Slope"),Rating:n(t,"Rating"),MaxScorePerHole:n(t,"MaxScorePerHole"),CourseTeeBoxHandicap:n(t,"CourseTeeBoxHandicap")}}),e.SaveARound=function(){t.AddRound(e.model,o).then(function(o){e.ShowSavedSuccessfulModal=!0},function(t){o.ShowValidationErrors(e,t)})},e.SaveARoundDialogOkEvent=function(){window.location.href="ViewRounds"},e.FetchCoursesForState=function(){t.FetchCoursesForState(e.model.StateId).then(function(o){e.CourseLookup=o.data.CourseData,null!=e.CourseLookup&&e.CourseLookup.length>0&&(e.model.CourseId=e.CourseLookup[0].CourseId,e.FetchTeeBoxesForCourse())},function(e){alert("Error Calling FetchCoursesForState")})},e.FetchTeeBoxesForCourse=function(){return null==e.model.CourseId?(e.model.TeeLocationId=null,void(e.TeeBoxLookup=null)):void t.FetchTeeBoxForCourseId(e.model.CourseId).then(function(o){e.model.TeeLocationId=o.data.TeeBoxData[0].CourseTeeLocationId,e.TeeBoxLookup=o.data.TeeBoxData},function(e){alert("Error Calling FetchTeeBoxesForCourse")})}}])}(),function(){"use strict";appToracGolf.service("RoundHttp",["$http",function(e){return{AddRound:function(o,t){return e.post("AddARound",o,t)},FetchCoursesForState:function(o){return e.post("CourseSelectByState",o)},FetchTeeBoxForCourseId:function(o){return e.post("TeeLocationSelectForCourseId",o)},RoundListing:function(o,t,n,a,r,i,u,c){return e.post("RoundListingSelectPage",{ResetPager:o,PageIndexId:t,SortBy:n,CourseNameFilter:a,SeasonFilter:r,RoundsPerPage:i,RoundDateStartFilter:isNaN(Date.parse(u))?null:u,RoundDateEndFilter:isNaN(Date.parse(c))?null:c})},RoundDelete:function(o){return e.post("RoundDelete",o)}}}])}(),function(){appToracGolf.controller("RoundListingController",["$scope","ValidationService","RoundHttp","PagerFactory",function(e,o,t,n){e.$watch("SearchByRoundDateEnd",function(o,t){e.WatchRoundDateFilter(o,t)}),e.$watch("SearchByRoundDateStart",function(o,t){e.WatchRoundDateFilter(o,t)}),e.WatchRoundDateFilter=function(o,t){o!=t&&e.FetchAPageOfData(!0)},e.init=function(o,t,n,a){e.SortByLookup=t,e.RoundsPerPageLookup=a,e.SortBy=t[0].Value,e.RoundsPerPage=n,e.SearchByCourseName="",e.SearchByRoundDateStart="",e.SearchByRoundDateEnd="",e.CurrentPageId=0,e.BuildPager(o),e.FetchAPageOfData(!1)},e.BuildPager=function(o){e.TotalNumberOfPages=o,e.PagerElements=n.BuildPagerModel(o)},e.PagerClick=function(o){e.CurrentPageId=o,e.FetchAPageOfData(!1)},e.FetchAPageOfData=function(o){o&&(e.CurrentPageId=0),t.RoundListing(o,e.CurrentPageId,e.SortBy,e.SearchByCourseName,e.SeasonFilter,e.RoundsPerPage,e.SearchByRoundDateStart,e.SearchByRoundDateEnd).then(function(o){e.PagedData=o.data.PagedData.ListingData,e.CourseImageLookup=o.data.PagedData.CourseImages,null!=o.data.TotalNumberOfPages&&e.BuildPager(o.data.TotalNumberOfPages)},function(e){alert("Error: "+JSON.stringify(e))})},e.FindCourseImageFromLookup=function(o){return e.CourseImageLookup[o]},e.DeleteARound=function(o){e.RoundIdToDelete=o,e.DeleteRoundModalShow=!0},e.DeleteARoundConfirm=function(){t.RoundDelete(e.RoundIdToDelete).then(function(o){e.DeleteRoundModalShow=!1,e.FetchAPageOfData(!0),$("#SeasonHandicap").text(null==o.data.NewHandicap.SeasonHandicap?"":o.data.NewHandicap.SeasonHandicap),$("#CareerHandicap").text(null==o.data.NewHandicap.CareerHandicap?"":o.data.NewHandicap.CareerHandicap)},function(e){alert("Error: "+JSON.stringify(e))})},e.RootPath=function(){return _rootDir}}])}();