var appToracGolf=angular.module("toracApp",["ngAnimate"]);!function(){"use strict";appToracGolf.directive("datePicker",function(){return{require:"?ngModel",restrict:"A",link:function(e,o,t,n){o.datepicker({maxDate:t.maxdate,onSelect:function(o){e.$apply(function(){e.model.RoundDate=o})}})}}})}(),function(){"use strict";appToracGolf.factory("FileReader",["$q","$log",function(e,o){var t=function(e,o,t){return function(){t.$apply(function(){o.resolve(e.result)})}},n=function(e,o,t){return function(){t.$apply(function(){o.reject(e.result)})}},r=function(e,o){return function(e){o.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}},a=function(e,o){var a=new FileReader;return a.onload=t(a,e,o),a.onerror=n(a,e,o),a.onprogress=r(a,o),a};return{ReadAsDataURL:function(o,t){var n=e.defer();if(null==o)return n.resolve(null),n.promise;var r=a(n,t);return r.readAsDataURL(o),n.promise}}}])}(),function(){"use strict";appToracGolf.factory("httpRequestInterceptor",["$q",function(e){return{request:function(e){return e.headers.RequestVerificationToken=$("#__RequestVerificationToken").val(),$("#loadingDiv").show(),e},requestError:function(o){return $("#loadingDiv").hide(),e.reject(o)},response:function(e){return $("#loadingDiv").hide(),e},responseError:function(o){return $("#loadingDiv").hide(),e.reject(o)}}}]),appToracGolf.config(["$httpProvider",function(e){e.interceptors.push("httpRequestInterceptor")}])}(),function(){"use strict";appToracGolf.directive("modal",function(){return{template:'<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">{{title}}</h4></div><div class="modal-body">{{bodyhtml}}</div><div class="modal-footer"><button type="button" class="btn btn-default btn-primary" data-dismiss="modal">{{closebuttontext}}</button></div></div></div></div>',restrict:"EA",replace:!0,transclude:!0,scope:{onmodalcloseevent:"&",ShowSavedSuccessfulModal:"="},link:function(e,o,t){e.title=t.title,e.bodyhtml=t.bodyhtml,e.closebuttontext=t.closebuttontext,e.$parent.$watch(t.showdialog,function(e){$(o).modal(e?"show":"hide")}),$(o).on("shown.bs.modal",function(){e.$apply(function(){e.$parent[t.visible]=!0})}),$(o).on("hidden.bs.modal",function(){e.$apply(function(){e.$parent[t.visible]=!1,e.onmodalcloseevent()})})}}})}(),function(){"use strict";appToracGolf.directive("numbersOnly",function(){return{require:"ngModel",restrict:"A",scope:!0,link:function(e,o,t,n){function r(e,o){if(void 0==e)return"";var t;return t=o?e.replace(/[^0-9]/g,""):e.replace(/[^0-9.]/g,""),isNaN(t)&&(t=n.$modelValue),t!=e&&(n.$setViewValue(t),n.$render()),t}e.allowInts="true"===t.numbersOnlyAllowonlyints.toLowerCase(),n.$parsers.push(function(o){var t=e.allowInts;return r(o,t)})}}})}(),function(){"use strict";appToracGolf.factory("PagerFactory",function(){return{BuildPagerModel:function(e){for(var o=[],t=0;e>t;t++)o.push(t);return o}}})}(),function(){"use strict";appToracGolf.directive("select2",function(){return{require:"?ngModel",restrict:"A",scope:{ngModel:"="},link:function(e,o,t,n){e.$watch("ngModel",function(t){null!=t&&e.$$postDigest(function(){o.val(typeof e.ngModel+":"+t).trigger("change")})}),o.select2({placeholder:"Select a state"})}}})}(),function(){"use strict";appToracGolf.service("ValidationService",function(){return{ShowValidationErrors:function(e,o){if(e.validationErrors=[],o.data&&angular.isObject(o.data))for(var t in o.data)e.validationErrors.push(o.data[t][0]);else e.validationErrors.push(o.data)}}})}(),function(){appToracGolf.controller("RoundAddController",["$scope","ValidationService","RoundHttp","$filter",function(e,o,t,n){e.init=function(o){e.model=o,e.FetchCoursesForState()},e.$watch("model.RoundDate",function(o){e.model.RoundDate=n("date")(o,"MM/dd/yyyy")}),e.$watch("model.TeeLocationId",function(o){var t=null;null!=o&&null!=e.TeeBoxLookup&&(t=e.TeeBoxLookup.FirstOrDefault(function(e){return e.CourseTeeLocationId==o}));var n=function(e,o){return null==e?null:e[o]};e.TeeBoxSelectedInfo={Yardage:n(t,"Yardage"),Par:null==t?null:t.Front9Par+t.Back9Par,Slope:n(t,"Slope"),Rating:n(t,"Rating"),MaxScorePerHole:16}}),e.SaveARound=function(){t.AddRound(e.model,o).then(function(o){e.ShowSavedSuccessfulModal=!0},function(t){o.ShowValidationErrors(e,t)})},e.SaveARoundDialogOkEvent=function(){window.location.href="ViewRounds"},e.FetchCoursesForState=function(){t.FetchCoursesForState(e.model.StateId).then(function(o){e.CourseLookup=o.data.CourseData,null!=e.CourseLookup&&e.CourseLookup.length>0&&(e.model.CourseId=e.CourseLookup[0].CourseId,e.FetchTeeBoxesForCourse())},function(e){alert("Error Calling FetchCoursesForState")})},e.FetchTeeBoxesForCourse=function(){return null==e.model.CourseId?(e.model.TeeLocationId=null,void(e.TeeBoxLookup=null)):void t.FetchTeeBoxForCourseId(e.model.CourseId).then(function(o){e.model.TeeLocationId=o.data.TeeBoxData[0].CourseTeeLocationId,e.TeeBoxLookup=o.data.TeeBoxData},function(e){alert("Error Calling FetchTeeBoxesForCourse")})}}])}(),function(){"use strict";appToracGolf.service("RoundHttp",["$http",function(e){return{AddRound:function(o,t){return e.post("AddARound",o,t)},FetchCoursesForState:function(o){return e.post("CourseSelectByState",{StateId:o})},FetchTeeBoxForCourseId:function(o){return e.post("TeeLocationSelectForCourseId",{CourseId:o})},RoundListing:function(o,t,n,r,a,i){return e.post("RoundListingSelectPage",{ResetPager:o,PageIndexId:t,SortBy:n,RoundNameFilter:r,SeasonFilter:a,RoundsPerPage:i})}}}])}(),function(){appToracGolf.controller("RoundListingController",["$scope","ValidationService","RoundHttp","PagerFactory",function(e,o,t,n){e.init=function(o,t,n,r){e.SortByLookup=t,e.RoundsPerPageLookup=r,e.SortBy=t[0].Value,e.RoundsPerPage=n,e.SearchByRoundName="",e.CurrentPageId=0,e.BuildPager(o),e.FetchAPageOfData(!1)},e.BuildPager=function(o){e.TotalNumberOfPages=o,e.PagerElements=n.BuildPagerModel(o)},e.PagerClick=function(o){e.CurrentPageId=o,e.FetchAPageOfData(!1)},e.FetchAPageOfData=function(o){o&&(e.CurrentPageId=0),t.RoundListing(o,e.CurrentPageId,e.SortBy,e.SearchByRoundName,e.SeasonFilter,e.RoundsPerPage).then(function(o){e.PagedData=o.data.PagedData.ListingData,e.CourseImageLookup=o.data.PagedData.CourseImages,null!=o.data.TotalNumberOfPages&&e.BuildPager(o.data.TotalNumberOfPages)},function(e){alert("Error: "+JSON.stringify(e))})},e.FindCourseImageFromLookup=function(o){return e.CourseImageLookup[o]}}])}(),function(){appToracGolf.controller("CourseAddController",["$scope","ValidationService","FileReader","CourseHttp",function(e,o,t,n){e.init=function(o){e.model=o,e.ViewMode="AddCourse"},e.SaveACourse=function(){t.ReadAsDataURL(document.getElementById("CoursePicture").files[0],e).then(function(t){e.model.CourseImage=t,n.AddCourse(e.model,o).then(function(o){e.ShowSavedSuccessfulModal=!0},function(t){o.ShowValidationErrors(e,t)})})},e.SaveACourseDialogOkEvent=function(){window.location.href="ViewCourses"},e.AddTeeLocation=function(){e.TeeLocationTitle="Add A New Tee Location",e.InitTeeLocationView(null,{Description:"",Front9Par:null,Back9Par:null,Yardage:null,Slope:null,Rating:null,Par:function(){return parseInt(this.Front9Par)+parseInt(this.Back9Par)}})},e.EditTeeLocation=function(o){e.TeeLocationTitle="Edit Tee Location",e.InitTeeLocationView(o,e.model.TeeLocations[o])},e.InitTeeLocationView=function(o,t){e.validationErrors=[],e.TempTeeBeforeModifying={Index:o,Model:angular.copy(t)},e.ViewMode="EditTeeLocation",e.TempTeeLocation=angular.copy(t),null!=o&&e.model.TeeLocations.splice(o,1)},e.CancelTeeLocation=function(){e.validationErrors=[],null!=e.TempTeeBeforeModifying.Index&&e.model.TeeLocations.splice(e.TempTeeBeforeModifying.Index,0,e.TempTeeBeforeModifying.Model),e.ViewMode="AddCourse"},e.SaveTeeLocation=function(){return e.model.TeeLocations.Any(function(o){return o.Description===e.TempTeeLocation.Description})?void o.ShowValidationErrors(e,{data:"There is already a tee box with the same name"}):void n.AddTeeLocation(e.TempTeeLocation,o).then(function(o){e.model.TeeLocations.push(e.TempTeeLocation),e.ViewMode="AddCourse",e.validationErrors=[]},function(t){o.ShowValidationErrors(e,t)})},e.DeleteTeeLocation=function(o){e.model.TeeLocations.splice(o,1)},e.DefaultTeeButton=function(o){(o.which&&13==o.which||o.keyCode&&13==o.keyCode)&&e.SaveTeeLocation()}}])}(),function(){"use strict";appToracGolf.service("CourseHttp",["$http",function(e){return{AddCourse:function(o,t){return e.post("AddACourse",o,t)},AddTeeLocation:function(o,t){return e.post("ValidateTeeLocation",o,t)},CourseListing:function(o,t,n,r,a,i){return e.post("CourseListingSelectPage",{ResetPager:o,PageIndexId:t,SortBy:n,CourseNameFilter:r,StateFilter:a,CoursesPerPage:i})}}}])}(),function(){appToracGolf.controller("CourseListingController",["$scope","ValidationService","CourseHttp","PagerFactory",function(e,o,t,n){e.init=function(o,t,n,r,a){e.SortByLookup=t,e.CoursesPerPageLookup=a,e.SortBy=t[0].Value,e.CoursesPerPage=r,e.StateFilter=n,e.SearchByCourseName="",e.CurrentPageId=0,e.BuildPager(o),e.FetchAPageOfData(!1)},e.BuildPager=function(o){e.TotalNumberOfPages=o,e.PagerElements=n.BuildPagerModel(o)},e.PagerClick=function(o){e.CurrentPageId=o,e.FetchAPageOfData(!1)},e.FetchAPageOfData=function(o){o&&(e.CurrentPageId=0),t.CourseListing(o,e.CurrentPageId,e.SortBy,e.SearchByCourseName,e.StateFilter,e.CoursesPerPage).then(function(o){e.PagedData=o.data.PagedData,null!=o.data.TotalNumberOfPages&&e.BuildPager(o.data.TotalNumberOfPages)},function(e){alert("Error: "+JSON.stringify(e))})}}])}();